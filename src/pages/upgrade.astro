---
import Layout from '../layouts/Layout.astro';
import { FaSolidFolder, FaSolidShareNodes, FaSolidRobot } from 'solid-icons/fa';
import { VsLoading } from 'solid-icons/vs';
import RazorPayIcon from '../icons/razorpay.svg';
---

<Layout title="Upgrade to Plus | Sim8085" showActions={false} fullwidth={false} fullHeight={false}>
    <main class="mx-auto py-8 px-4" x-data="payment" x-init="init">
        <h1 class="text-2xl mb-6 font-bold">Upgrade to Sim8085 Plus</h1>
        <div class="my-4">
            <div class="flex items-center gap-4 pb-8">
                <div class="text-2xl text-green-600 bg-green-200 w-12 h-12 rounded flex items-center justify-center">
                    <FaSolidFolder />
                </div>
                <div>
                    <h3 class={"mb-1"}>Save and Organize Files</h3>
                    <p class="text-sm text-secondary-foreground">
                        Save up to 5 files on the free plan. Go Plus for unlimited saves and
                        better workspace management.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4 pb-8">
                <div class="text-2xl text-blue-600 bg-blue-200 w-12 h-12 rounded flex items-center justify-center">
                    <FaSolidShareNodes />
                </div>
                <div>
                    <h3 class="mb-1">Public Share Links</h3>
                    <p class="text-sm text-secondary-foreground">
                        Share your 8085 programs with anyone using a simple link.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4 pb-8">
                <div class="text-2xl text-purple-600 bg-purple-200 w-12 h-12 rounded flex items-center justify-center">
                    <FaSolidRobot />
                </div>
                <div>
                    <h3 class="mb-1">AI Help for Assembler Errors</h3>
                    <p class="text-sm text-secondary-foreground">
                        Confused by assembler errors? Let AI explain what went wrong and how to
                        fix it.
                    </p>
                </div>
            </div>
            {/*
            <div class="flex items-center gap-4 pb-8">
                <div class="text-3xl text-blue-600 bg-blue-200 w-12 h-12 rounded flex items-center justify-center">
                    <FaSolidGraduationCap />
                </div>
                <div>
                    <h3 class="flex items-center gap-2 mb-1">
                        <span>Step-by-Step Tutorials</span>
                        <span class="bg-terminal-200 text-terminal rounded px-2 py-1 uppercase text-[0.6rem]">
                            Coming Soon
                        </span>
                    </h3>
                    <p class="text-sm text-secondary-foreground">
                        Master 8085 ALP with easy, step-by-step tutorials.
                    </p>
                </div>
            </div>
            */}
        </div>
        <div class="mb-4">
            <ul class="space-y-3">
                <li>
                    âœ… One-time payment  
                </li>
                <li>
                    ðŸ•• Valid for 6 months  
                </li>
                <li class="text-lg">
                    ðŸ’¸ 
                    <span class="text-secondary-foreground line-through decoration-double decoration-red-500">â‚¹699</span> â‚¹349 only
                </li>
            </ul>
        </div>
        <template x-if="isLoading">
            <div class="flex items-center gap-2">
                <VsLoading class="animate-spin" />
                <span class="text-sm text-inactive-foreground">Loading Plus status...</span>
            </div>
        </template>
        <template x-if="!user && !isLoading">
            <div class="text-left">
                <p class="mb-4">Please login to continue.</p>
                <a href="/login/" class="px-4 py-2 bg-yellow-foreground hover:bg-orange-foreground text-gray-900 font-bold rounded">Login</a>
            </div>
        </template>
        <template x-if="user && !isPlus && !isLoading">
            <div>
                <div>
                    <a class="bg-yellow-foreground hover:bg-orange-foreground rounded px-6 py-3 text-gray-900 font-bold inline-flex items-center gap-2 cursor-pointer" href="https://rzp.io/rzp/sim8085plus">
                        <span>
                            <RazorPayIcon width={16} height={16}/>
                        </span>
                        <span>
                            Pay with Razorpay
                        </span>
                    </a>
                </div>
            </div>
        </template>
        <template x-if="isPlus && !isLoading">
            <div class="text-left bg-main-background border border-terminal rounded p-4 pb-5">
                <p class="text-green-foreground font-medium mb-2">âœ… You already have Sim8085 Plus!</p>
                <p class="text-sm text-secondary-foreground mb-4">
                    Thank you for supporting Sim8085. Enjoy all the premium features.
                </p>
                <a href="/" class="px-4 py-2 bg-terminal-700 hover:bg-terminal-600 text-primary-foreground rounded transition-colors">Back to Sim8085</a>
            </div>
        </template>
    </main>
</Layout>

<script>
import Alpine from 'alpinejs';
import { getUser } from '../lib/supabase.js';
import { getUserTier } from '../lib/subscription.js';

document.addEventListener('alpine:init', () => {
    Alpine.data('payment', () => ({
        isLoading: true,
        user: null,
        isPlus: false,

        async init() {
            const { user } = await getUser();
            this.user = user;

            if (!user) {
                this.isLoading = false;
                return;
            }

            const { tier } = await getUserTier();

            if (tier === "PLUS") {
                this.isPlus = true;
            }
            this.isLoading = false;
        },
    }));
});
</script>
