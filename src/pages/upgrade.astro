---
import Layout from '../layouts/Layout.astro';
import { FaSolidFolder, FaSolidShareNodes, FaSolidRobot, FaSolidHeart, FaSolidCircleCheck, FaSolidBan } from 'solid-icons/fa';
import { VsLoading } from 'solid-icons/vs';
import { DODO_PLUS_PAYMENT_LINK } from 'astro:env/client';
---

<Layout title="Sim8085 Plus – Pricing & Benefits" showActions={false} fullwidth={false} fullHeight={false}>
  <main class="mx-auto py-10 px-4 max-w-3xl" x-data="payment" x-init="init">
    <h1 class="text-3xl font-bold mb-6 text-center">Sim8085 Plus</h1>

    <!-- Pricing Highlight Box -->
    <div class="bg-yellow-foreground/10 border border-yellow-400 rounded-lg p-6 mb-2 text-center text-text">
      <p class="text-lg font-semibold text-text">One-Time Payment</p>
      <p class="text-xl font-bold my-2">
        <span class="line-through text-gray-500 mr-1 decoration-red-foreground">$8</span>
        <span class="text-terminal">$4 only</span>
      </p>
            <p class="text-sm flex items-center gap-2 justify-center">
                <FaSolidCircleCheck class="text-terminal"/>
                <span>
                Valid for 6 months
                </span>
            </p>
    </div>

    <p class="text-xs text-inactive-foreground mt-2 text-center mb-8">
        Approx. ₹342 for 6 months (based on current rates)
    </p>


    <!-- Loading State -->
    <template x-if="isLoading">
      <div class="flex items-center justify-center gap-2">
        <VsLoading class="animate-spin" />
        <span class="text-sm text-inactive-foreground">Checking Plus status...</span>
      </div>
    </template>

    <!-- Not Logged In -->
    <template x-if="!user && !isLoading">
      <div class="text-center">
        <p class="mb-4">Please login to continue.</p>
        <a href="/login/" class="px-5 py-2 bg-yellow-foreground hover:bg-orange-foreground text-gray-900 font-bold rounded">
          Login
        </a>
      </div>
    </template>

    <!-- Show Pay Button -->
    <template x-if="user && !isPlus && !isLoading">
      <div class="text-center">
        <a :href={'`${$el.dataset.link}?quantity=1&redirect_url=https://www.sim8085.com%2Fplus-thank-you%2F&fullName=${user.user_metadata.name}&email=${user.email}&disableEmail=true`'}
                    class="bg-yellow-foreground/80 hover:bg-yellow-foreground px-6 py-3 text-gray-900 font-bold inline-flex items-center gap-2 rounded"
            data-link={DODO_PLUS_PAYMENT_LINK}
        >
          <span>Upgrade Now</span>
        </a>
      </div>
    </template>

    <!-- Already Subscribed -->
    <template x-if="isPlus && !isLoading">
      <div class="bg-secondary-background border border-terminal rounded p-5 text-left">
        <p class="text-green-foreground font-medium mb-2">✅ You already have Sim8085 Plus!</p>
        <p class="text-sm text-secondary-foreground mb-4">Thank you for supporting Sim8085. Enjoy all the premium features.</p>
        <a href="/" class="px-4 py-2 bg-terminal-700 hover:bg-terminal-600 text-white rounded">Back to Sim8085</a>
      </div>
    </template>

    <!-- Feature List -->
    <div class="space-y-2 md:space-y-6 mb-10 mt-8">

        <div class="flex items-start md:items-center gap-4 pb-4 md:pb-8">
            <div class="text-lg md:text-2xl text-green-600 md:bg-green-200 w-8 h-8 md:w-12 md:h-12 rounded flex items-start md:items-center justify-center">
                <FaSolidFolder />
            </div>
            <div>
                <h3 class="font-semibold mb-1">Save and Organize Files</h3>
                <p class="text-sm text-secondary-foreground">Save up to 5 files on the free plan. Go Plus for unlimited saves and better workspace management.</p>
            </div>
        </div>
        <div class="flex items-start md:items-center gap-4 pb-4 md:pb-8">
            <div class="text-lg md:text-2xl text-blue-600 md:bg-blue-200 w-8 h-8 md:w-12 md:h-12 rounded flex items-start md:items-center justify-start md:justify-center">
                <FaSolidShareNodes />
            </div>
            <div>
                <h3 class="font-semibold mb-1">Public Share Links</h3>
                <p class="text-sm text-secondary-foreground">Share your 8085 programs with anyone using a simple link.</p>
            </div>
        </div>
        <div class="flex items-start md:items-center gap-4 pb-4 md:pb-8">
            <div class="text-lg md:text-2xl text-purple-600 md:bg-purple-200 w-8 h-8 md:w-12 md:h-12 rounded flex items-start md:items-center justify-start md:justify-center">
                <FaSolidRobot />
            </div>
            <div>
                <h3 class="font-semibold mb-1">AI Help for Assembler Errors</h3>
                <p class="text-sm text-secondary-foreground">Confused by assembler errors? Let AI explain what went wrong and how to fix it.</p>
            </div>
        </div>
        <div class="flex items-start md:items-center gap-4 pb-4 md:pb-8">
            <div class="text-lg md:text-2xl text-red-600 md:bg-red-200 w-8 h-8 md:w-12 md:h-12 rounded flex items-start md:items-center justify-start md:justify-center">
                <FaSolidBan />
            </div>
            <div>
                <h3 class="mb-1">No Ads, No Distractions</h3>
                <p class="text-sm text-secondary-foreground">
                    Enjoy a clean and distraction-free experience by removing all ads from
                    the site.
                </p>
            </div>
        </div>
        <div class="flex items-start md:items-center gap-4 pb-4 md:pb-8">
            <div class="text-lg md:text-2xl text-yellow-600 md:bg-yellow-200 w-8 h-8 md:w-12 md:h-12 rounded flex items-start md:items-center justify-start md:justify-center">
                <FaSolidHeart />
            </div>
            <div>
                <h3 class="font-semibold mb-1">Support Development</h3>
                <p class="text-sm text-secondary-foreground">
                Sim8085 is built with love to help students. Your support keeps it ad-free, maintained, and evolving.
                </p>
            </div>
        </div>

    </div>

    <p class="text-sm text-center text-secondary-foreground mt-6 mb-8">
        ✨ More exciting features are planned for <strong>both Free and Plus users</strong>. <span class="text-terminal font-semibold">Your support helps make it happen.</span>
    </p>

    <!-- Plan Comparison Table -->
    <div class="overflow-x-auto border border-border rounded mb-10 hidden">
    <table class="min-w-full text-sm text-left text-gray-300 bg-background">
        <thead class="text-xs uppercase bg-border text-gray-400">
        <tr>
            <th class="px-4 py-3">Feature</th>
            <th class="px-4 py-3 text-center">Free</th>
            <th class="px-4 py-3 text-center">Plus</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-border">
        <tr>
            <td class="px-4 py-3">File Saves</td>
            <td class="px-4 py-3 text-center">Up to 5</td>
            <td class="px-4 py-3 text-center font-semibold text-green-400">Unlimited</td>
        </tr>
        <tr>
            <td class="px-4 py-3">Public Share Links</td>
            <td class="px-4 py-3 text-center text-red-500">✘</td>
            <td class="px-4 py-3 text-center text-green-400 font-bold">✔</td>
        </tr>
        <tr>
            <td class="px-4 py-3">AI Help for Assembler Errors</td>
            <td class="px-4 py-3 text-center text-red-500">✘</td>
            <td class="px-4 py-3 text-center text-green-400 font-bold">✔</td>
        </tr>
        <tr>
            <td class="px-4 py-3">Step-by-Step Tutorials</td>
            <td class="px-4 py-3 text-center">Limited</td>
            <td class="px-4 py-3 text-center font-semibold">Full Access <span class="text-xs">(Coming Soon)</span></td>
        </tr>
        <tr>
            <td class="px-4 py-3">Support Development</td>
            <td class="px-4 py-3 text-center">–</td>
            <td class="px-4 py-3 text-center">✅ You're amazing ❤️</td>
        </tr>
        <tr class="bg-yellow-800/30">
            <td class="px-4 py-3 font-semibold text-white">Price</td>
            <td class="px-4 py-3 text-center font-semibold">Free</td>
            <td class="px-4 py-3 text-center font-bold text-yellow-300">₹349 / 6 months</td>
        </tr>
        </tbody>
    </table>
    </div>

  </main>
</Layout>

<script>
import Alpine from 'alpinejs';
import { getUser } from '../lib/supabase.js';
import { getUserTier } from '../lib/subscription.js';

document.addEventListener('alpine:init', () => {
  Alpine.data('payment', () => ({
    isLoading: true,
    user: null,
    isPlus: false,

    async init() {
      const { user } = await getUser();
      this.user = user;

      if (!user) return this.isLoading = false;

      const { tier } = await getUserTier();
      this.isPlus = tier === 'PLUS';
      this.isLoading = false;
    }
  }));
});
</script>
